name: 'Amplify Deploy'
on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the code
      uses: actions/checkout@v2
    
    - name: Install Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Install Amplify CLI
      run: |
        npm install -g @aws-amplify/cli

    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt  # Install Python dependencies

    - name: Build and freeze the app
      run: |
        python freeze.py   # Generate static files

    - name: Deploy to Amplify
      run: |
        amplify publish --appId d2a5heqc1vs1ae --envName dev --yes
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_REGION: us-east-1
